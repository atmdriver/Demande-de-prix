<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simulateur VTC</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h3>Simulateur de Prix VTC</h3>

        <label>Adresse de départ :</label>
        <input type="text" id="startAddress" placeholder="Ex: Paris, France" oninput="getAddressSuggestions(this.value, 'start')">
        <div id="startSuggestions" class="autocomplete-suggestions"></div>

        <label>Adresse d'arrivée :</label>
        <input type="text" id="endAddress" placeholder="Ex: Lyon, France" oninput="getAddressSuggestions(this.value, 'end')">
        <div id="endSuggestions" class="autocomplete-suggestions"></div>

        <button onclick="calculatePrice()">Calculer</button>

        <p id="result">Prix estimé : - €</p>
    </div>

    <script>
        const apiKey = "5b3ce3597851110001cf6248ce52305d63b541e9b030f687415cb54f";

        async function getAddressSuggestions(query, type) {
            if (query.length < 3) return;
            
            const url = `https://api.openrouteservice.org/geocode/autocomplete?api_key=${apiKey}&text=${encodeURIComponent(query)}`;
            const response = await fetch(url);
            const data = await response.json();

            if (!data.features || data.features.length === 0) return;

            const container = type === 'start' ? document.getElementById("startSuggestions") : document.getElementById("endSuggestions");
            container.innerHTML = "";

            data.features.forEach(feature => {
                const div = document.createElement("div");
                div.textContent = feature.properties.label;
                div.onclick = () => {
                    document.getElementById(type === 'start' ? "startAddress" : "endAddress").value = feature.properties.label;
                    container.innerHTML = "";
                };
                container.appendChild(div);
            });
        }

        async function getCoordinates(address) {
            const url = `https://api.openrouteservice.org/geocode/search?api_key=${apiKey}&text=${encodeURIComponent(address)}`;
            const response = await fetch(url);
            const data = await response.json();

            if (!data.features || data.features.length === 0) {
                alert("Adresse introuvable.");
                return null;
            }

            return data.features[0].geometry.coordinates;
        }

        async function calculatePrice() {
            const startAddress = document.getElementById("startAddress").value;
            const endAddress = document.getElementById("endAddress").value;

            if (!startAddress || !endAddress) {
                alert("Veuillez entrer les deux adresses.");
                return;
            }

            const startCoords = await getCoordinates(startAddress);
            const endCoords = await getCoordinates(endAddress);

            if (!startCoords || !endCoords) {
                alert("Erreur de géolocalisation.");
                return;
            }

            const routeUrl = `https://api.openrouteservice.org/v2/directions/driving-car?api_key=${apiKey}&start=${startCoords[0]},${startCoords[1]}&end=${endCoords[0]},${endCoords[1]}`;

            try {
                const response = await fetch(routeUrl);
                const data = await response.json();

                if (!data.routes || data.routes.length === 0 || !data.routes[0].summary) {
                    throw new Error("Itinéraire non trouvé.");
                }

                const distanceKm = data.routes[0].summary.distance / 1000;
                if (isNaN(distanceKm) || distanceKm <= 0) {
                    throw new Error("Distance invalide.");
                }

                const baseFare = 2;
                const perKm = 1.5;
                const minPrice = 5;
                let price = baseFare + (distanceKm * perKm);
                price = Math.max(price, minPrice);

                document.getElementById("result").innerText = `Prix estimé : ${price.toFixed(2)} €`;
            } catch (error) {
                console.error("Erreur calcul:", error);
                document.getElementById("result").innerText = "Erreur lors du calcul.";
            }
        }
    </script>
</body>
</html>
